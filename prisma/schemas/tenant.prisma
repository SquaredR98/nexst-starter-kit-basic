// Tenant Database Schema - Business Operations
// Handles tenant business data with state branch management and GST compliance

generator tenantClient {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/tenant"
}

datasource tenantDb {
  provider = "postgresql"
  url      = env("TENANT_DATABASE_URL")
}

// ============================================================================
// ORGANIZATION & STATE BRANCH MANAGEMENT
// ============================================================================

model Organization {
  id          String  @id @default(cuid())
  name        String
  slug        String  @unique
  description String?
  logo        String?
  website     String?
  industry    String?

  // Business Information
  panNumber String? // Company PAN
  cinNumber String? // Corporate Identification Number
  country   String  @default("IN")
  currency  String  @default("INR")
  timezone  String  @default("Asia/Kolkata")

  // Platform Connection
  platformTenantId String @unique // Links to central platform

  // Status
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  stateBranches StateBranch[]
  users         User[]
  departments   Department[]
  roles         Role[]
  permissions   Permission[]
  customers     Customer[]
  suppliers     Supplier[]
  products      Product[]
  transactions  Transaction[]
  gstReturns    GSTReturn[]
  auditLogs     AuditLog[]

  // Customization relations
  tenantCustomizations TenantCustomization[]
  tenantThemes         TenantTheme[]
  tenantWidgets        TenantWidget[]
  tenantCustomFields   TenantCustomField[]
  tenantWorkflows      TenantWorkflow[]

  @@map("organizations")
}

model StateBranch {
  id             String @id @default(cuid())
  organizationId String
  stateName      String // "Maharashtra", "Karnataka"
  stateCode      String // "MH", "KA"
  gstNumber      String // State-specific GST registration
  branchName     String // "Mumbai Office", "Bangalore Branch"
  branchCode     String // Internal branch code

  // Address Information
  address Json // Complete address details
  pinCode String
  city    String

  // Branch Configuration
  isHeadOffice Boolean @default(false)
  isActive     Boolean @default(true)

  // GST Configuration for this state
  gstConfiguration Json // CGST, SGST rates, exemptions

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization       Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  users              User[]
  customers          Customer[]
  suppliers          Supplier[]
  transactions       Transaction[]
  gstReturns         GSTReturn[]
  inventoryLocations InventoryLocation[]

  @@unique([organizationId, stateCode])
  @@unique([organizationId, branchCode])
  @@map("state_branches")
}

// ============================================================================
// USER MANAGEMENT WITH STATE-BASED ACCESS CONTROL
// ============================================================================

model User {
  id             String  @id @default(cuid())
  organizationId String
  email          String  @unique
  username       String? @unique
  firstName      String
  lastName       String
  phone          String?
  avatar         String?
  passwordHash   String?

  // State-based Access Control
  stateBranchId     String? // NULL for tenant admins (company-wide access)
  isStateRestricted Boolean @default(true) // false for tenant admins

  // User Status
  emailVerified DateTime?
  phoneVerified DateTime?
  isActive      Boolean   @default(true)
  lastLoginAt   DateTime?

  // Employment Details
  employeeId   String?
  designation  String?
  departmentId String?
  managerId    String?
  joinDate     DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  stateBranch  StateBranch? @relation(fields: [stateBranchId], references: [id])
  department   Department?  @relation("DepartmentEmployees", fields: [departmentId], references: [id])
  manager      User?        @relation("UserManager", fields: [managerId], references: [id])
  subordinates User[]       @relation("UserManager")

  // RBAC
  userRoles UserRole[]

  // Business Relations
  assignedCustomers   Customer[]    @relation("CustomerAssignments")
  createdTransactions Transaction[] @relation("TransactionCreator")

  // Audit
  auditLogs AuditLog[] @relation("AuditUser")

  // Sessions
  sessions Session[]

  // Customization relations
  tenantCustomizationsCreated    TenantCustomization[] @relation("TenantCustomizationCreatedBy")
  tenantCustomizationsUpdated    TenantCustomization[] @relation("TenantCustomizationUpdatedBy")
  tenantThemesCreated            TenantTheme[]         @relation("TenantThemeCreatedBy")
  tenantThemesUpdated            TenantTheme[]         @relation("TenantThemeUpdatedBy")
  tenantWidgets                  TenantWidget[]
  tenantWidgetsCreated           TenantWidget[]        @relation("TenantWidgetCreatedBy")
  tenantWidgetsUpdated           TenantWidget[]        @relation("TenantWidgetUpdatedBy")
  tenantCustomFieldsCreated      TenantCustomField[]   @relation("TenantCustomFieldCreatedBy")
  tenantCustomFieldsUpdated      TenantCustomField[]   @relation("TenantCustomFieldUpdatedBy")
  tenantWorkflowsCreated         TenantWorkflow[]      @relation("TenantWorkflowCreatedBy")
  tenantWorkflowsUpdated         TenantWorkflow[]      @relation("TenantWorkflowUpdatedBy")

  @@map("users")
}

enum UserRoleType {
  TENANT_ADMIN // Company-wide access, all states
  STATE_ADMIN // Single state, all modules
  STATE_MANAGER // Single state, management functions
  ACCOUNTS_MANAGER // State-specific accounting
  SALES_MANAGER // State-specific sales
  PURCHASE_MANAGER // State-specific purchases
  INVENTORY_MANAGER // State-specific inventory
  ACCOUNTS_USER // Basic accounting operations
  SALES_USER // Basic sales operations
  PURCHASE_USER // Basic purchase operations
  INVENTORY_USER // Basic inventory operations
  REPORT_VIEWER // Read-only access for reports
  GUEST_USER // Limited read access
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Department {
  id             String   @id @default(cuid())
  organizationId String
  name           String
  code           String
  description    String?
  parentId       String?
  managerId      String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent       Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children     Department[] @relation("DepartmentHierarchy")
  employees    User[]       @relation("DepartmentEmployees")

  @@unique([organizationId, code])
  @@map("departments")
}

// ============================================================================
// ROLE-BASED ACCESS CONTROL
// ============================================================================

model Role {
  id             String   @id @default(cuid())
  organizationId String
  name           String
  description    String?
  level          Int      @default(1) // Role hierarchy level
  isSystemRole   Boolean  @default(false)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  organization Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  permissions  RolePermission[]
  userRoles    UserRole[]

  @@unique([organizationId, name])
  @@map("roles")
}

model Permission {
  id             String           @id @default(cuid())
  organizationId String
  name           String
  description    String?
  module         ModuleType
  action         PermissionAction
  scope          PermissionScope
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  // Relations
  organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]

  @@unique([organizationId, name])
  @@map("permissions")
}

model RolePermission {
  id           String   @id @default(cuid())
  roleId       String
  permissionId String
  createdAt    DateTime @default(now())

  // Relations
  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model UserRole {
  id         String    @id @default(cuid())
  userId     String
  roleId     String
  assignedBy String?
  assignedAt DateTime  @default(now())
  expiresAt  DateTime?
  isActive   Boolean   @default(true)

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@map("user_roles")
}

enum ModuleType {
  FINANCIAL
  INVENTORY
  CRM
  HUMAN_RESOURCES
  MANUFACTURING
  PROJECT_MANAGEMENT
  ADMINISTRATION
  REPORTS
  GST_COMPLIANCE
}

enum PermissionAction {
  CREATE
  READ
  UPDATE
  DELETE
  APPROVE
  EXPORT
  IMPORT
  MANAGE
}

enum PermissionScope {
  GLOBAL
  ORGANIZATION
  STATE_BRANCH
  DEPARTMENT
  TEAM
  PERSONAL
}

// ============================================================================
// BUSINESS ENTITIES WITH STATE CONTEXT
// ============================================================================

model Customer {
  id             String  @id @default(cuid())
  organizationId String
  stateBranchId  String // Customer belongs to specific state branch
  code           String
  name           String
  email          String?
  phone          String?
  website        String?

  // Address Information
  billingAddress  Json
  shippingAddress Json?

  // Business Information
  gstNumber    String?
  panNumber    String?
  customerType CustomerType @default(B2B)

  // Customer Classification
  category    String? // "Premium", "Regular", "New"
  creditLimit Float   @default(0)
  creditDays  Int     @default(30)

  // State Context
  isInterstate Boolean @default(false) // Customer from different state

  // Relationship Management
  contactPerson String?
  assignedTo    String? // User ID for assigned sales rep

  // Status
  status   CustomerStatus @default(ACTIVE)
  isActive Boolean        @default(true)
  notes    String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  stateBranch  StateBranch   @relation(fields: [stateBranchId], references: [id])
  assignedUser User?         @relation("CustomerAssignments", fields: [assignedTo], references: [id])
  transactions Transaction[]

  // Custom fields
  customFields      Json     @default("{}") // Store custom field values

  @@unique([organizationId, code])
  @@map("customers")
}

model Supplier {
  id             String  @id @default(cuid())
  organizationId String
  stateBranchId  String // Supplier registered with specific state branch
  code           String
  name           String
  email          String?
  phone          String?
  website        String?

  // Address Information
  address Json

  // Business Information
  gstNumber    String?
  panNumber    String?
  supplierType SupplierType @default(GOODS)

  // Payment Terms
  paymentTerms Int   @default(30) // Days
  creditLimit  Float @default(0)

  // State Context
  isInterstate Boolean @default(false)

  // Status
  isActive Boolean @default(true)
  notes    String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  stateBranch  StateBranch   @relation(fields: [stateBranchId], references: [id])
  transactions Transaction[]

  // Custom fields
  customFields      Json     @default("{}") // Store custom field values

  @@unique([organizationId, code])
  @@map("suppliers")
}

model Product {
  id             String  @id @default(cuid())
  organizationId String
  code           String
  name           String
  description    String?

  // Product Classification
  category    String?
  subcategory String?
  brand       String?
  model       String?

  // GST Information
  hsnCode     String? // HSN/SAC code for GST
  gstCategory String  @default("goods") // "goods", "services"

  // Pricing
  basePrice     Float @default(0)
  sellingPrice  Float @default(0)
  purchasePrice Float @default(0)

  // Inventory
  unit          String @default("PCS") // "PCS", "KG", "LTR", etc.
  minStockLevel Float  @default(0)
  maxStockLevel Float  @default(0)

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization     Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  inventory        InventoryItem[]
  transactionItems TransactionItem[]

  // Custom fields
  customFields      Json     @default("{}") // Store custom field values

  @@unique([organizationId, code])
  @@map("products")
}

model InventoryLocation {
  id            String  @id @default(cuid())
  stateBranchId String
  name          String // "Main Warehouse", "Shop Floor"
  code          String
  description   String?
  address       Json?
  isActive      Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  stateBranch StateBranch     @relation(fields: [stateBranchId], references: [id])
  inventory   InventoryItem[]

  @@unique([stateBranchId, code])
  @@map("inventory_locations")
}

model InventoryItem {
  id           String @id @default(cuid())
  productId    String
  locationId   String
  quantity     Float  @default(0)
  reservedQty  Float  @default(0) // Reserved for orders
  availableQty Float  @default(0) // Available = Quantity - Reserved

  // Cost Information
  averageCost Float @default(0)
  lastCost    Float @default(0)

  // Stock Levels
  reorderLevel Float @default(0)
  maxLevel     Float @default(0)

  // Timestamps
  lastUpdated   DateTime  @default(now())
  lastStockTake DateTime?

  // Relations
  product  Product           @relation(fields: [productId], references: [id])
  location InventoryLocation @relation(fields: [locationId], references: [id])

  @@unique([productId, locationId])
  @@map("inventory_items")
}

enum CustomerType {
  B2B // Business to Business
  B2C // Business to Consumer
  EXPORT // Export customer
  DEALER // Authorized dealer
  DISTRIBUTOR // Distributor
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  BLOCKED
  SUSPENDED
}

enum SupplierType {
  GOODS // Goods supplier
  SERVICES // Service provider
  BOTH // Both goods and services
  CONTRACTOR // Contractor
}

// ============================================================================
// TRANSACTION MANAGEMENT WITH GST
// ============================================================================

model Transaction {
  id                String  @id @default(cuid())
  organizationId    String
  fromStateBranchId String // Source state branch
  toStateBranchId   String? // For inter-state transactions

  // Transaction Basic Info
  transactionNumber String          @unique
  transactionType   TransactionType
  transactionDate   DateTime
  dueDate           DateTime?

  // Parties
  customerId String?
  supplierId String?

  // Financial Details
  subtotal       Float @default(0)
  discountAmount Float @default(0)
  taxableAmount  Float @default(0)

  // GST Calculations
  cgstRate       Float? // Only for intrastate
  sgstRate       Float? // Only for intrastate  
  igstRate       Float? // Only for interstate
  cessRate       Float? // Additional cess
  cgstAmount     Float  @default(0)
  sgstAmount     Float  @default(0)
  igstAmount     Float  @default(0)
  cessAmount     Float  @default(0)
  totalTaxAmount Float  @default(0)
  totalAmount    Float  @default(0)

  // Payment Information
  paymentStatus PaymentStatus @default(PENDING)
  paymentMethod String?
  paymentDate   DateTime?

  // GST Compliance
  gstReturnId    String? // Linked to GST return
  invoiceNumber  String? // Government invoice number
  eWayBillNumber String? // For goods movement

  // Status & Metadata
  status    TransactionStatus @default(DRAFT)
  notes     String?
  createdBy String

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization    Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  fromStateBranch StateBranch       @relation(fields: [fromStateBranchId], references: [id])
  customer        Customer?         @relation(fields: [customerId], references: [id])
  supplier        Supplier?         @relation(fields: [supplierId], references: [id])
  gstReturn       GSTReturn?        @relation(fields: [gstReturnId], references: [id])
  createdByUser   User              @relation("TransactionCreator", fields: [createdBy], references: [id])
  items           TransactionItem[]

  // Custom fields
  customFields      Json     @default("{}") // Store custom field values

  @@map("transactions")
}

model TransactionItem {
  id            String @id @default(cuid())
  transactionId String
  productId     String

  // Item Details
  description    String?
  quantity       Float
  unit           String  @default("PCS")
  unitPrice      Float   @default(0)
  discountRate   Float   @default(0)
  discountAmount Float   @default(0)
  lineTotal      Float   @default(0)

  // GST for this item
  hsnCode   String?
  gstRate   Float   @default(0)
  cgstRate  Float   @default(0)
  sgstRate  Float   @default(0)
  igstRate  Float   @default(0)
  taxAmount Float   @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product     Product     @relation(fields: [productId], references: [id])

  @@map("transaction_items")
}

enum TransactionType {
  SALE_INVOICE // Sale to customer
  PURCHASE_INVOICE // Purchase from supplier
  CREDIT_NOTE // Credit note to customer
  DEBIT_NOTE // Debit note to supplier
  QUOTATION // Sales quotation
  PURCHASE_ORDER // Purchase order
  DELIVERY_NOTE // Delivery challan
  RECEIPT_NOTE // Goods receipt
  RETURN_SALE // Sales return
  RETURN_PURCHASE // Purchase return
}

enum TransactionStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT
  DELIVERED
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
  VOID
}

enum PaymentStatus {
  PENDING
  PARTIALLY_PAID
  PAID
  OVERDUE
  REFUNDED
}

// ============================================================================
// GST COMPLIANCE & RETURNS
// ============================================================================

model GSTReturn {
  id             String @id @default(cuid())
  organizationId String
  stateBranchId  String

  // Return Details
  returnType   TenantGSTReturnType
  periodMonth  Int // 1-12
  periodYear   Int
  filingStatus FilingStatus  @default(DRAFT)

  // Calculated Values
  totalSales     Float @default(0)
  totalPurchases Float @default(0)
  cgstPayable    Float @default(0)
  sgstPayable    Float @default(0)
  igstPayable    Float @default(0)
  cessPayable    Float @default(0)
  inputTaxCredit Float @default(0)
  netTaxPayable  Float @default(0)

  // Filing Information
  preparedBy     String? // User who prepared
  reviewedBy     String? // User who reviewed
  filedBy        String? // User who filed
  filedDate      DateTime?
  acknowledgment String? // Government acknowledgment number

  // Compliance
  dueDate        DateTime
  penaltyAmount  Float    @default(0)
  interestAmount Float    @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  stateBranch  StateBranch   @relation(fields: [stateBranchId], references: [id])
  transactions Transaction[]

  @@unique([organizationId, stateBranchId, returnType, periodMonth, periodYear])
  @@map("gst_returns")
}

enum TenantGSTReturnType {
  GSTR1 // Outward supplies
  GSTR3B // Summary return
  GSTR9 // Annual return
  GSTR2A // Auto-populated inward supplies
  GSTR4 // Quarterly return for composition dealers
}

enum FilingStatus {
  DRAFT
  PREPARED
  UNDER_REVIEW
  READY_TO_FILE
  FILED
  LATE_FILED
  REVISED
  REJECTED
}

// ============================================================================
// AUDIT LOGGING
// ============================================================================

model AuditLog {
  id             String @id @default(cuid())
  organizationId String

  // Action Details
  action     String // "CUSTOMER_CREATED", "INVOICE_GENERATED", etc.
  entityType String // "customer", "transaction", "user"
  entityId   String?
  oldValues  Json? // Previous values
  newValues  Json? // New values

  // User Context
  userId    String?
  ipAddress String?
  userAgent String?

  // Results
  success      Boolean @default(true)
  errorMessage String?

  // Timestamps
  timestamp DateTime @default(now())

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User?        @relation("AuditUser", fields: [userId], references: [id])

  @@index([organizationId, timestamp])
  @@index([entityType, entityId])
  @@index([userId, timestamp])
  @@map("audit_logs")
}

model TenantCustomization {
  id                String   @id @default(cuid())
  organizationId    String
  
  // Branding configuration
  branding          Json     @default("{}") // { logo, primaryColor, secondaryColor, accentColor, fontFamily, theme, customCSS }
  
  // Dashboard configuration
  dashboard         Json     @default("{}") // { layout, widgets, defaultView, quickActions }
  
  // Custom fields configuration
  customFields      Json     @default("{}") // { customers: [], products: [], transactions: [] }
  
  // Workflow configuration
  workflows         Json     @default("{}") // { approvals: [], notifications: [], automations: [] }
  
  // User preferences
  preferences       Json     @default("{}") // { dateFormat, numberFormat, timezone, currency, language }
  
  // Metadata
  version           Int      @default(1)
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String
  updatedBy         String
  
  // Relations
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdByUser     User         @relation("TenantCustomizationCreatedBy", fields: [createdBy], references: [id])
  updatedByUser     User         @relation("TenantCustomizationUpdatedBy", fields: [updatedBy], references: [id])
  
  @@map("tenant_customizations")
}

model TenantTheme {
  id                String   @id @default(cuid())
  organizationId    String
  
  // Theme configuration
  themeName         String
  themeData         Json     // Complete theme configuration
  
  // Theme metadata
  isDefault         Boolean  @default(false)
  isActive          Boolean  @default(true)
  version           String   @default("1.0.0")
  
  // Metadata
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String
  updatedBy         String
  
  // Relations
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdByUser     User         @relation("TenantThemeCreatedBy", fields: [createdBy], references: [id])
  updatedByUser     User         @relation("TenantThemeUpdatedBy", fields: [updatedBy], references: [id])
  
  @@unique([organizationId, themeName])
  @@map("tenant_themes")
}

model TenantWidget {
  id                String   @id @default(cuid())
  organizationId    String
  userId            String?  // null = organization-wide, specific user = personal widget
  
  // Widget configuration
  widgetType        String   // 'gst-summary', 'revenue-chart', 'recent-transactions', etc.
  widgetTitle       String
  position          Json     // { x, y, w, h } for grid positioning
  configuration     Json     @default("{}") // Widget-specific config
  
  // Widget metadata
  isVisible         Boolean  @default(true)
  isLocked          Boolean  @default(false) // Prevents user modification
  order             Int      @default(0)
  
  // Metadata
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String
  updatedBy         String
  
  // Relations
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user              User?        @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdByUser     User         @relation("TenantWidgetCreatedBy", fields: [createdBy], references: [id])
  updatedByUser     User         @relation("TenantWidgetUpdatedBy", fields: [updatedBy], references: [id])
  
  @@map("tenant_widgets")
}

model TenantCustomField {
  id                String   @id @default(cuid())
  organizationId    String
  
  // Field configuration
  entityType        String   // 'customer', 'product', 'transaction', 'supplier'
  fieldName         String
  fieldLabel        String
  fieldType         String   // 'text', 'number', 'date', 'dropdown', 'checkbox', 'file', 'textarea'
  
  // Field options and validation
  isRequired        Boolean  @default(false)
  isVisible         Boolean  @default(true)
  isEditable        Boolean  @default(true)
  validationRules   Json     @default("{}") // { min, max, pattern, options, etc. }
  defaultValue      String?
  
  // Display configuration
  displayOrder      Int      @default(0)
  groupName         String?  // For grouping fields in UI
  helpText          String?
  placeholder       String?
  
  // Metadata
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String
  updatedBy         String
  
  // Relations
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdByUser     User         @relation("TenantCustomFieldCreatedBy", fields: [createdBy], references: [id])
  updatedByUser     User         @relation("TenantCustomFieldUpdatedBy", fields: [updatedBy], references: [id])
  
  @@unique([organizationId, entityType, fieldName])
  @@map("tenant_custom_fields")
}

model TenantWorkflow {
  id                String   @id @default(cuid())
  organizationId    String
  
  // Workflow configuration
  workflowName      String
  workflowType      String   // 'approval', 'notification', 'automation'
  entityType        String   // 'transaction', 'customer', 'product', etc.
  
  // Workflow definition
  triggerConditions Json     @default("{}") // When this workflow triggers
  actions           Json     @default("{}") // What actions to perform
  approvalSteps     Json     @default("{}") // Multi-step approval process
  
  // Workflow metadata
  isActive          Boolean  @default(true)
  priority          Int      @default(0)
  
  // Metadata
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdBy         String
  updatedBy         String
  
  // Relations
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdByUser     User         @relation("TenantWorkflowCreatedBy", fields: [createdBy], references: [id])
  updatedByUser     User         @relation("TenantWorkflowUpdatedBy", fields: [updatedBy], references: [id])
  
  @@unique([organizationId, workflowName])
  @@map("tenant_workflows")
}
